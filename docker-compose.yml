services:
  iapd:
    build:
      context: .
      dockerfile: Dockerfile
    image: iapd:latest
    container_name: iapd-parser
    
    # Mount the data directory
    volumes:
      - ~/Work/IAPD:/app/Data
    
    # Environment variables
    environment:
      # Java JVM options - adjust memory settings as needed
      - JAVA_OPTS=-Xmx4g -Xms1g -XX:+UseG1GC -XX:+UseStringDeduplication
      # Optional: Set logging level
      - LOG_LEVEL=INFO
    
    # Restart policy
    restart: "no"
    
    # Optional: Override the default command
    # command: ["--index-limit", "1000", "--verbose"]
    
    # Optional: Set working directory
    working_dir: /app/Data
    
    # Optional: Add labels for organization
    labels:
      - "project=iapd"
      - "component=parser"
      - "environment=production"

  # Optional: Add a service for development/testing with different settings
  iapd-dev:
    build:
      context: .
      dockerfile: Dockerfile
    image: iapd:latest
    container_name: iapd-parser-dev
    
    volumes:
      - ~/Work/IAPD:/app/Data
    
    environment:
      - JAVA_OPTS=-Xmx2g -Xms512m -XX:+UseG1GC -XX:+UseStringDeduplication
      - LOG_LEVEL=DEBUG
    
    restart: "no"
    
    # Development mode with limited processing
    command: ["--index-limit", "100", "--verbose"]
    
    labels:
      - "project=iapd"
      - "component=parser"
      - "environment=development"
    
    # Don't start this service by default
    profiles:
      - dev

# Optional: Define a network for the services
networks:
  default:
    name: iapd-network
    driver: bridge

# Optional: Define named volumes (if you prefer named volumes over bind mounts)
volumes:
  iapd-data:
    driver: local
    # Uncomment to use a named volume instead of bind mount
    # driver_opts:
    #   type: none
    #   o: bind
    #   device: ~/Work/IAPD
